{
    "name": "create-scratch",
    "guards": [ "sfInstalled" ],
    "arguments": { "scratchName": { "default": "${branchName}" }, "permissionSet": { "default": "${permissionSet}" }, "dias": { "default": "7" } },
    "description": "Crea una scratch Org y sube el codigo con datos de prueba",
    "errorMessage": "No se pudo asociar la branch ${branchName} al remote. verifique con git branch -vv ",
    "steps": [
        { "criteria": { "field": "existScratch", "value": false }, "name": "Crea la scracth org" , "command": "sf org create scratch --set-default", "arguments": { "--definition-file": "${projectPath}/config/project-scratch-def.json", "--alias":"${scratchName}", "--name": "${scratchName}", "--duration-days": "${dias}" }, "errorMessage": "No se pudo crear la scracth org, verifique que no se haya pasado del limite scratchs (3 activas)* sf org list --clean\n* o bien si quedo en la mitad del proceso\n* sf org resume" },
        { "criteria": { "field": "existScratch", "value": true }, "name": "Ya existe la Scratch ${scratchName}. Cambia la default org" , "command": "sf force config set", "arguments": { "--target-org": "${scratchName}" } },
        { "name": "Sube el codigo" , "command": "sf project deploy start", "arguments": { "--target-org": "${scratchName}" },  "errorMessage": "No se pudo subir el codigo" },
        { "criteria": { "field": "permissionSet" }, "name": "Asigna los permisos" , "command": "sf org assign permset ", "arguments": { "--target-org": "${scratchName}", "--name": "${permissionSet}" } },
        { "name": "Subiendo los datos" , "command": "sf data tree import", "arguments": { "--target-org": "${scratchName}", "--plan": "${projectPath}/data/plan.json" } },
        { "name": "Seteando la scracth en modo debug" , "command": "sf apex run", "arguments": { "--file": "${projectPath}/scripts/apex/debugMode.apex", "--target-org": "${scratchName}" } },
        { "name": "Generando la password" , "command": "sf org generate password", "arguments": { "--target-org": "${scratchName}" } },
        { "name": "Ingresa a la scratch" , "command": "sf open org -r", "arguments": { "--target-org": "${scratchName}" } }
    ] 
}